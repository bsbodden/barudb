sequenceDiagram
    participant Client
    participant Bloom as SpeedDB Bloom Filter
    participant Hash as Hash Function
    participant Storage as Bit Storage
    
    %% Insert operation
    Client->>+Bloom: insert(key)
    Bloom->>+Hash: hash(key)
    Hash-->>-Bloom: primary_hash_value
    
    Bloom->>Bloom: compute probe locations from hash
    Note right of Bloom: Extract block1, offset1, block2, offset2
    
    Bloom->>+Storage: set_bit(block1, offset1)
    Storage-->>-Bloom: ok
    
    Bloom->>+Storage: set_bit(block2, offset2)
    Storage-->>-Bloom: ok
    
    Bloom-->>-Client: success
    
    %% Query operation with early exit
    Client->>+Bloom: may_contain(key)
    Bloom->>+Hash: hash(key)
    Hash-->>-Bloom: primary_hash_value
    
    Bloom->>Bloom: compute probe locations from hash
    Note right of Bloom: Extract block1, offset1, block2, offset2
    
    Bloom->>+Storage: is_bit_set(block1, offset1)
    Storage-->>-Bloom: false
    
    Note right of Bloom: Early exit - key definitely not in set
    Bloom-->>-Client: false (definitely not present)
    
    %% Query operation that needs both probes
    Client->>+Bloom: may_contain(another_key)
    Bloom->>+Hash: hash(another_key)
    Hash-->>-Bloom: primary_hash_value
    
    Bloom->>Bloom: compute probe locations from hash
    Note right of Bloom: Extract block1, offset1, block2, offset2
    
    Bloom->>+Storage: is_bit_set(block1, offset1)
    Storage-->>-Bloom: true
    
    Note right of Bloom: First bit set, check second bit
    Bloom->>+Storage: is_bit_set(block2, offset2)
    Storage-->>-Bloom: true
    
    Note right of Bloom: Both bits set - key might be in set
    Bloom-->>-Client: true (possibly present)
    
    %% Concurrent operation
    Client->>+Bloom: add_concurrently(key)
    Bloom->>+Hash: hash(key)
    Hash-->>-Bloom: primary_hash_value
    
    Bloom->>Bloom: compute probe locations from hash
    
    Bloom->>+Storage: atomic_set_bit(block1, offset1)
    Storage-->>-Bloom: ok
    
    Bloom->>+Storage: atomic_set_bit(block2, offset2)
    Storage-->>-Bloom: ok
    
    Bloom-->>-Client: success